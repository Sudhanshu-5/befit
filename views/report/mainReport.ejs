<%- include ("../partials/header") %>
    <link rel="stylesheet" href="/stylesheets/trend_calendar.css"/>
    <link rel="stylesheet" href="/stylesheets/mainreport.css"/>

<div class="container mt-5">
<div class="alert alert-primary" role="alert" id="no-record-r">
  No records added <a href="/addMeal" >Add Meal</a> <a href="/addExercise" >Add Exercise</a> 
</div>
<div class="row">
    <div class="col-9 row">
            <div id="report-header" class="col-12">
               <div id="range-div-r">
            <span style='font-size:1.5rem'>Report # </span>  <select id="range-select-r"  class="form-contro" name="rangeReport"  placeholder="0">
                <option value="today">Today</option>
                <option value="allDate">All dates</option>
               <option value="yesterday">Yesterday</option>
                <option data-toggle="modal" data-target="#exampleModal" id="custom-report" value="custom">Custom duration</option>
              </select>
        </div>
        <div id="custom-range-r">
           <button id="range-btn-r" class="btn mt-2" style="background-color: rgba(227, 125, 95, .8);color:white">Get range</button>
        </div>
            </div>
            <div class="col-12 my-5" id="show-report"></div>
    </div>
  <div class="col-3">
     

  </div>


        
</div>
   
    <div class="modal fade" id="from-to-r" tabindex="-1" role="dialog" aria-labelledby="from-to-r" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body row">
              <div id="first-r" class="col-6">
                  <div class=" calender border border-secondary px-0">
                            <div class="date d-flex justify-content-between align-items-center ">
                                    <i class="prev-date fa fa-angle-left  ml-3" aria-hidden="true"></i>
                                      <div class="dateString">
                                      </div> 
                                    <i class="next-date fa fa-angle-right  mr-3" aria-hidden="true"></i>
                            </div>
                            <div class="showCalender">
                              <div class="year-month d-flex justify-content-between align-items-center" >
                                <div>
                                      <i class="prev-year fas fa-angle-double-left ml-3"></i>
                                      <i class="prev-month fas fa-angle-left "></i>
                                 </div>
                                  <div class="myString">
                                      
                                  </div>
                                    <div>
                                      <i class="next-month fas fa-angle-right "></i>
                                      <i class="next-year fas fa-angle-double-right mr-3"></i>
                                    </div>
                                  
                              </div>
                              <div class="weekdays d-flex justify-content-around ">
                                  <div>Sun</div> 
                                  <div>Mon</div>
                                  <div>Tue</div>
                                  <div>Wed</div>
                                  <div>Thu</div>
                                  <div>Fri</div>
                                  <div>Sat</div>
                               </div>
                                
                                <div class="days d-flex flex-wrap">
                                  
                                </div> 
                                
                            </div>
                     </div>
               
                </div>
                
                 <div id="second-r" class="col-6">

                 </div>
                 
                       
          </div>
          <div class="d-inline-flex justify-content-around from-to-date">
            <span id="from-r"></span>
            <span>To</span>
            <span id="to-r"></span>
          </div>
           <div id="err-mssg-r">This duration is senseless</div>
           <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" id="save-r" class="btn btn-primary">Save changes</button>
           </div>
        </div>
      </div>
    </div>
   
   
  </div>

 <script>
   
  
          let length;//for length in calorie-date file
          let consumedArray=[];
          let burnedArray=[];
          let dates=[];
          let dataset=[];
          let type;
          const today = new Date()
          const yesterday = new Date(today)
          yesterday.setDate(yesterday.getDate() - 1);
           let burn_target;
                  let value_now;
                  let p_bar;
                  let remain;
                  let avg=0;
                  let efficiency;
                  let sum=0;
                  let sum2=0;
                  let efficiency2;
                  let avg2=0;
      
        let selected="today";
        let from="";
        let to="";
        let valid_from;
        let valid_to;
        let text;
        let text2;
        let labe;
        let label2;
        $(document).ready(function(){
         generateReport(selected,from,to);    
         })
          
        $("#range-select-r").on('change',(function(){
          selected= $(this).val();
           //alert(selected)
        
        if( selected=="custom"){
          $("#from-r").text(today.toLocaleDateString());
           $("#to-r").text(today.toLocaleDateString());
            $("#from-to-r").modal('show');
            $("#custom-range-r").show();
            $("#custom-range-r").click(function(){
              $("#from-to-r").modal('show');
            })            
        }
       else{
          from="";
          to="";
          $("#custom-range-r").hide();
        }   
                    
             generateReport(selected,from,to);
        }));
        
            

   $(".modal-content #err-mssg-r").hide();
   let m0,m1,d0,d1,y0,y1;
          $("#second-r").append($("#first-r").html());

       function extractWithDate(mm, dd, yy,k) {
                  $(".modal-content #err-mssg-r").hide();

                console.log("inside exctract fun"+mm+1+"/"+dd+"/"+yy)
                if(k==0){
                  $("#from-r").text(mm+1 +"/"+dd+"/"+yy);
                  m0=mm;
                  d0=dd;
                  y0=yy
                }
                else if(k==1) 
                {
                  $("#to-r").text(mm+1 +"/"+dd+"/"+yy)
                  m1=mm;
                  d1=dd;
                  y1=yy;
                }
                
                from=$("#from-r").text();
                to=$("#to-r").text();
                $("#save-r").unbind().click( function () {
                  
                            $("#from-to-r").modal('hide');
                                      generateReport(selected,from,to)
                                      
                })
              // console.log("mooooooooooooooooo"+m0+"m111"+m1+"asssssss"+d0+"sadddd"+d1)
                  if((m0 == m1 && d0 > d1)   ||  y0>y1 &&(selected=="custom") ){
                      $(".modal-content #err-mssg-r").show();
                  }
             }


     function generateReport(selected,from,to){
  
       
       const months = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December",
    ];
    //    if(selected=="allDate"){
    //    $("#report-header").html("<span style='font-size:1.5rem'>Report # </span> All time records");
    //  } else {
    //         $("#report-header").html("<span style='font-size:1.5rem'>Report # </span>"+selected);
    //  }
     if(<%-findeduser.macroNutrientInfo.length%>){
         $("#show-graph").html("<img id='gif' src='images/load.gif'>")
         $.ajax({
                    type: "GET", 
                    url: "/generateReport",
                    data:{selected:selected,from:from,to:to},
                    
                    success: function (result) {
                      
                    $('#show-report').html(result);
                    
                    
                    },
                    error: function (xhr, status) {
                        alert("Sorry, there was a problem :(");
                    },
                
                });
              }
              else{
                 $("#no-record-r").show()
              }
        
     }
    

</script>
                             

 <script src="/script/calender.js"></script>

<script>
        getCalendar(0);
        getCalendar(1);
</script>
<%- include ("../partials/footer") %>

