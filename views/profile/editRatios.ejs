<%- include ("../partials/profileHeader") %>
    <link rel="stylesheet" href="/stylesheets/editRatio.css"/>

<%=JSON.stringify(ratio)%>
<!-- Button trigger modal -->
<h3 id="no-bmr">Activity factor is unknown</h3>


	<div id="canvas">
<canvas id="ratioChart" width="400" height="100"></canvas>
<!-- Button trigger modal -->
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Launch demo modal
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

			<form action="/editRatios?_method=PUT" method="POST"> 
				<div  class="d-flex flex-wrap justify-content-around input-ratios">
			    <div>
				<label>Carbs:
			    <input class="per" id="carbs" type="number"  name="eratio[carbs]" value="<%=ratio.carbs%>">
				</label>
				</div>
				<div>
				<label>Fats:
				<input class="per" id="fats" type="number" name="eratio[fats]" value="<%=ratio.fats%>">
				</label> 
				</div>
				<div>
				<label>Protiens:
				<input class="per" id="protiens" type="number"  name="eratio[protiens]" value="<%=ratio.protiens%>">
				</label>
				</div>
				</div>
			<button id="ratio-submit" type="button">save</button>
		
		
			</form>
			<div id="message">Ratio must add to 100!!</div>
			<div id="help"></div>
			<a href="/bmr">change activity factor</a>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
	let html="";
	if(<%=findeduser.activityFactor%>== 1.2){
		html="<p>Recommended macronutrient ratios for your activity factor, "+<%=JSON.stringify(findeduser.activityFactor)%>+"</p>"+
				 "<p>carbs: 45 to 50 percent of total carbohydrates</p>"+
				 "<p>fats: 20 to 25 percent of total fats</p>"+
				 "<p>protiens: 25 to 30 percent of total protiens</p>"
		$("#help").append(html);
	}
	else if(<%=findeduser.activityFactor%> == 1.375 || <%=findeduser.activityFactor%> == 1.55){
		html="<p>Recommended macronutrient ratios for your activity factor, "+<%=JSON.stringify(findeduser.activityFactor)%>+"</p>"+
				 "<p>carbs: 55 to 65 percent of total carbohydrates</p>"+
				 "<p>fats: 30 percent of total fats</p>"+
				 "<p>protiens: 20-30 percent of total protiens</p>"
		$("#help").append(html);
	}
	else{
		html="<p>Recommended macronutrient ratios for your activity factor, "+<%=JSON.stringify(findeduser.activityFactor)%>+"</p>"+
				 "<p>carbs: 45 to 55 percent of total carbohydrates</p>"+
				 "<p>fats:  25 to 35 percent of total fats</p>"+
				 "<p>protiens: 10 to 15 percent of total protiens</p>"
		$("#help").append(html);
	}
	$("#no-bmr").hide();
	$("#message").hide();
	if(<%=findeduser.bmr%>==0){
	$("#no-bmr").show();
	$("#canvas").hide();
	}
   $("#ratio-submit").on("click",function(){
	   let total= parseInt($("#carbs").val())+parseInt($("#protiens").val())+parseInt($("#fats").val());
	   if(total==100){
		   $("#message").hide();
		   $("#ratio-submit").prop("type", "submit");
		   $("#ratio-submit").submit();
		  

	   }
	   else{
		   $("#message").show();
		}
   })

</script>
<script>
	var ratioCanvas = document.getElementById("ratioChart");
  var selectedIndex=null;
Chart.defaults.global.defaultFontFamily = "Lato";
Chart.defaults.global.defaultFontSize = 18;

var ratioData = {
    labels: [
		"Protiens",
		"Fats",
		"Carbs"
    ],
    datasets: [
        {
            data: [<%-Number(ratio.carbs)%>, <%-Number(ratio.fats)%>, <%-Number(ratio.protiens)%>],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)'
            ]
        }]
};

var pieChart = new Chart(ratioCanvas, {
  type: 'pie',
  data: ratioData,
   options: {
		onClick: function (evt, elements) {
			if (elements && elements.length) {
				var segment = elements[0];
				pieChart.update();
				if (selectedIndex !== segment["_index"]) {
					selectedIndex = segment["_index"];
					segment._model.outerRadius += 10;
				}
				else {
					selectedIndex = null;
				}
			}
    }
  },

    
})
</script>
</div>
<%- include ("../partials/footer") %>

<!-- <script>
window.onload = function () {
var chart = new CanvasJS.Chart("chartContainer", {
	theme: "light2",
	animationEnabled: true,
	title: {
		text: "Macronutrients ratio"
	},
	// subtitles: [{
	// 	text: "United Kingdom, 2016",
	// 	fontSize: 16
	// }],
	data: [{
		type: "pie",
		indexLabelFontSize: 18,
		radius: 80,
		indexLabel:  "{label} - #percent%",
		yValueFormatString: "###0.0\"%\"",
		click: explodePie,
		dataPoints: [
			{ y: <%-Number(ratio.carbs)%>*100, label: "Carbs" },
			{ y: <%-Number(ratio.fats)%>*100, label: "Fats" },
			{ y: <%-Number(ratio.protiens)%>*100, label: "Protiens" }
		]
	}]
});
chart.render();

function explodePie(e) {
	for(var i = 0; i < e.dataSeries.dataPoints.length; i++) {
		if(i !== e.dataPointIndex)
			e.dataSeries.dataPoints[i].exploded = false;
	}
}

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; width: 100%;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

</body>
</html> -->
